<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>React Native platform difference</title>
    <meta name="description" content="test the excerpt separator">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://beefe.github.io//rn/components/2016/05/06/react-native-platform-difference.html">
    <link rel="alternate" type="application/rss+xml" title="BeeFE" href="http://beefe.github.io//feed.xml">
</head>


<body>

    <!-- <header class="site-header">

  <div id="toggle">

    <a class="site-title" href="/">BeeFE</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>
 -->
    <div id=menu>
    <a id="toggle" href="#">
        <svg viewBox="0 0 18 15">
            <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
            <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
            <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
    </a>
    <ul>
        <li>
            <a href="/#components">Components</a>
        </li>
        <li>
            <a href="/#devtools">Dev Tools</a>
        </li>
        <li>
            <a href="/#sdk">IOS SDK</a>
        </li>
        <li>
            <a href="/#blog-readme">readme</a>
        </li>
    </ul>
</div>


    <div class="page-content">
        <div class="wrapper">
            <article class="content" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">React Native platform difference</h1>
        <p class="post-meta">
            
                
                <a class="author-name" href="http://xwenliang.cn/">xwenliang</a>
                <span class="header-desc"> Boss | </span>
            
            <time class="header-desc" datetime="2016-05-06T00:00:00+08:00" itemprop="datePublished">
                May 6, 2016
            </time>
        </p>
    </header>

    <div class="post-content" itemprop="articleBody">
        <p>test the excerpt separator
<!-- more --></p>

<p>#React Native 双平台差异及解决方法(0.20)</p>

<h3 id="section">标签及属性差异</h3>
<hr />

<p><strong>1. TextInput</strong>
- iOS下的<code class="highlighter-rouge">textAlign</code>取值 <code class="highlighter-rouge">auto</code> <code class="highlighter-rouge">left</code> <code class="highlighter-rouge">right</code> <code class="highlighter-rouge">center</code> <code class="highlighter-rouge">justify</code>
- android下的<code class="highlighter-rouge">textAlign</code>取值为 <code class="highlighter-rouge">start</code> <code class="highlighter-rouge">center</code> <code class="highlighter-rouge">end</code>
安卓平台有黑色边框和选中黄框，可通过设置<code class="highlighter-rouge">underlineColorAndroid='rgba(0,0,0,0)'</code>去掉
安卓平台无清除按钮，可以使用 <a href="https://github.com/beefe/react-native-textinput">react-native-textinput</a> 来兼容双平台</p>

<p><strong>2. Image</strong>
- iOS下<code class="highlighter-rouge">resizeMode</code>可以写在行间属性，也可以写在style，后者覆盖前者
- android下<code class="highlighter-rouge">resizeMode</code>只可以写在行间，写在style无效
<code class="highlighter-rouge">javascript
    //android
    &lt;Image resizeMode={'stretch'}&gt;&lt;/Image&gt;
    //ios, style中的cover会覆盖掉stretch
    &lt;Image resizeMode={'stretch'} style=resizeMode&gt;&lt;/Image&gt;
</code></p>

<p><strong>3. Text</strong>
- iOS下最主要的<code class="highlighter-rouge">padding</code>、<code class="highlighter-rouge">lineHeight</code>的 style 属性都正常支持
- android下<code class="highlighter-rouge">padding</code>、<code class="highlighter-rouge">lineHeight</code>无效，包括单独支持 android 的<code class="highlighter-rouge">textAlignVertical enum('auto', 'top', 'bottom', 'center')</code> 也不支持，解决办法就是 <code class="highlighter-rouge">padding</code> 改用 <code class="highlighter-rouge">margin</code>，或 <code class="highlighter-rouge">padding</code> 改用父节点 <code class="highlighter-rouge">padding</code>；<code class="highlighter-rouge">lineHeight</code> 改用 <code class="highlighter-rouge">marginTop</code> 负值
```javascript
    //双平台</p>

<div class="highlighter-rouge"><pre class="highlight"><code>let isAndroid = Platform.OS === 'android';

let styleTextLine1 = {
    fontSize: 12,
    marginBottom: 20,
};
let styleTextLine2 = {
    fontSize: 50,
    height: 50,
    lineHeight: 50, // ios
    marginTop: isAndroid ? -15 : 0,
};

&lt;View style=&gt;
    &lt;Text style={styleTextLine1}&gt;第一行，要求与第二行有间隔 20，字体大小 12&lt;/Text&gt;
    &lt;Text style={styleTextLine2}&gt;第二行，要求字体大小 50，字体上下居中，高度 50&lt;/Text&gt;
&lt;/View&gt; ```
</code></pre>
</div>

<p><strong>4. style <code class="highlighter-rouge">position: 'absolute'</code></strong>
- iOS下正常
- android下，<code class="highlighter-rouge">position: 'absolute'</code> 超过父节点高宽部分，会隐藏掉。解决办法：当需要用<code class="highlighter-rouge">position: 'absolute'</code>的时候，恰巧要求：子节点定位超出父节点高或宽，放弃使用，改用别的布局，或者将子节点放到于父节点同级，再定位。</p>

<p><strong>5. style <code class="highlighter-rouge">borderRadius</code></strong>
- iOS下正常
- Android下，不支持类似<code class="highlighter-rouge">borderTopLeftRadius</code>这种写法</p>

<h3 id="api">API差异</h3>
<p>–</p>

<p><strong>1. <code class="highlighter-rouge">api</code> NativeMethodsMixin <code class="highlighter-rouge">static measure(callback: MeasureOnSuccessCallback)</code></strong>
- iOS下正常
- android下，回调函数获取不到视图的尺寸 <code class="highlighter-rouge">x</code>、<code class="highlighter-rouge">y</code>、<code class="highlighter-rouge">width</code>、<code class="highlighter-rouge">heigth</code>、<code class="highlighter-rouge">pageX</code>、<code class="highlighter-rouge">pageY</code> 等值。可以考虑用 <code class="highlighter-rouge">onLayout</code> 属性来代替，需要注意的是，需要计算 layout 的视图，载入之后，防止内部不必要的重绘引起的尺寸变化，基本上保证 state 改变后，视图的尺寸即可预见。</p>

<h3 id="section-1">常见问题：</h3>
<p>–</p>

<p><strong>1. 返回事件的处理</strong>
- iOS如果使用<code class="highlighter-rouge">NavigatorIOS</code>，并且设置了<code class="highlighter-rouge">navigationBarHidden={true}</code>(隐藏NavigationBar)，将会导致右滑返回手势失效，解决方法：使用<code class="highlighter-rouge">Navigator</code>代替，但需要自己设置切场动画。
- android物理返回键，需要在每个<code class="highlighter-rouge">Navigator</code>的源头使用<code class="highlighter-rouge">BackAndroid</code>做监听，如果<code class="highlighter-rouge">this.navigator.state.routeStack.length === 1</code>，则可以认为当前处于根view，可以退出app。否则将navigator往回退1即可。
<code class="highlighter-rouge">javascript
    //android
    import React, {Navigator, BackAndroid} from 'react-native';
    //拓展类似于NavigatorIOS的popN
    Navigator.prototype.popN = function(n) {
        let routeStack = this.state.routeStack;
        let index = routeStack.length - n - 1;
        if (routeStack[index]) {
            this.popToRoute(routeStack[index]);
        }
    };
    class MyApp extends React.Component {
        ...
        componentDidMount(){
            BackAndroid.addEventListener('hardwareBackPress', () =&gt; {
                //不在根view, 往回退1，阻止退出
                if(this._navigator.state.routeStack.length &gt; 1){
                    this._navigator.popN(1);
                    return true;
                }
                //在根view，退出(或再次点击退出)
                else{
                    return false;
                }
            });
        }
        render(){
            &lt;Navigator
                ref={(navigator) =&gt; {
                    if(navigator !== this._navigator){
                        this._navigator = navigator;
                    }
                }}
            /&gt;
        }
    }
</code></p>

<p><strong>2. 有关屏幕的高度<code class="highlighter-rouge">Dimensions.get('window').height</code></strong>
- 两个平台都是整个屏幕的高度(包含statusBar, 安卓端不包含虚拟按键)
- iOS平台的布局是从statusBar的顶端开始
- android平台的布局是从statusBar的底端开始(设置<code class="highlighter-rouge">translucent: true</code>后也从statusBar顶端开始)
- 如果设置view的高度是<code class="highlighter-rouge">Dimensions.get('window').height</code>，然后设置<code class="highlighter-rouge">position: 'absolute', top: 0</code>，会发现android平台view的底端被遮住了一小部分，这一小部分正好就是android平台statusBar的高度
- 安卓端statusBar通常是25dp，虚拟按键通常是48dp
- 解决方法有四：
  - 设置view的高度是整屏的高度减去statusBar的高度
  - 设置<code class="highlighter-rouge">top</code>值为负的statusBar的高度
  - 设置<code class="highlighter-rouge">bottom: -Dimensions.get('window').height</code> 替代<code class="highlighter-rouge">top: 0</code>
  - 在每一个<code class="highlighter-rouge">Navigator</code>的入口设置<code class="highlighter-rouge">&lt;StatusBar translucent={true}/&gt;</code></p>

<ul>
  <li><b>大坑:</b> 有些手机通过上述方法获取到的屏幕高度竟然包含了虚拟按键的高度，如魅族pro4，只能引入<a href="https://github.com/rebeccahughes/react-native-device-info">react-native-device-info</a>这个库来hack一下了</li>
</ul>

<p><strong>3. Android过门动画卡顿</strong>
- 从测试结果来看是网络请求和过门动作同时进行导致，将网络请求延迟到过门动画结束后即可解决。深层原因？</p>

<p><strong>4. Android启动图launcher</strong>
- 修改MainActivity的父类ReactActivity，在加载RN的view的同时在该view上面覆盖一个原生的view，用来显示启动图，并且设置N秒后隐藏或等待拿到首页数据接口后隐藏</p>

<p><strong>5. 支持程度问题</strong>
- iOS支持7.0及以上
- Android支持API 16+ (Android 4.1) 因为使用了<a href="http://developer.android.com/reference/android/view/Choreographer.html">Choreographer</a>
- 友盟2016-02数据：
  - iOS7.0 以下已不计入主流版本(1%以下)，和其他非主流版本共占4.92%
  - Android4.0 还有2.16%，其他非主流版本共占7.47%</p>

    </div>

    <!-- Duoshuo Comment BEGIN -->
<a name="comments"> </a>
<div id="comment">
    <div class="ds-thread" data-urt="http://fex.baidu.com/rn/components/2016/05/06/react-native-platform-difference" data-title="React Native platform difference" data-thread-key="/rn/components/2016/05/06/react-native-platform-difference"></div>
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"fex"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = 'http://static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
</div>
<!-- Duoshuo Comment END -->

</article>


        </div>
    </div>

    <footer id="bottom">
    <!-- <div class="content">
        <p>A little better from Web Front End.
</p>
    </div> -->
</footer>

<script src="/scripts/zepto.min.js"></script>


</body>

</html>
